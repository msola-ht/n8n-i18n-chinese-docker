FROM n8nio/runners:2.0.3

USER root

# 1. 安装 Playwright (固定版本) 和其他依赖
# 尝试使用 uv add 添加 playwright 到现有项目
RUN cd /opt/runners/task-runner-python && \
    uv add --no-dev playwright==1.56.0 || \
    (echo "uv add failed, trying alternative method..." && \
     uv pip install --no-cache --index-strategy unsafe-any-match playwright==1.56.0) || \
    echo "Failed to install playwright, continuing without it"

# 2. 拷贝配置文件
COPY n8n-task-runners.json /etc/n8n-task-runners.json

USER runner